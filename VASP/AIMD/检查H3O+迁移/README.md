```markdown
# H3O+ Oxygen Analysis Script

## 简介
该脚本用于分析VASP分子动力学模拟生成的XDATCAR文件，检测具有H3O+特征的氧原子，并记录其坐标、帧编号及原子索引。适用于研究水合氢离子在基底表面的动态行为。

## 功能特性
- 自动识别晶胞参数与原子信息
- 周期性边界条件处理（支持镜像原子检测）
- H-O键长分析（键长阈值：1.2 Å）
- 三维坐标插值计算氧原子与基底距离
- 结果输出为结构化Excel文件

## 依赖环境
- Python 3.6+
- 必需库：
  ```bash
  numpy matplotlib xlsxwriter pandas scipy
  ```

## 使用说明
1. 将脚本与XDATCAR文件置于同一目录
2. 修改脚本第79行文件名（默认：'XDATCAR-4Pt-H3O+100'）
3. 运行脚本：
   ```bash
   python script_name.py
   ```
4. 结果文件 `H3O_plus_coordinates.xlsx` 将自动生成

## 输出文件说明
Excel文件包含以下列：
| 列名           | 描述                 |
|---------------|----------------------|
| Frame ID      | 帧编号（从0开始）     |
| Oxygen Atom ID| 氧原子全局索引         |
| X Coordinate  | 笛卡尔坐标X分量（Å）  |
| Y Coordinate  | 笛卡尔坐标Y分量（Å）  |
| Z Coordinate  | 笛卡尔坐标Z分量（Å）  |

## 关键算法
1. **键长检测**：
   - 检测所有O-H原子对
   - 考虑8个周期性镜像位置
   - 记录键长<1.2 Å的成键关系

2. **基底插值**：
   - 自动识别基底最上层原子
   - 使用线性插值计算氧原子z方向距离
   - 备选最近邻插值策略

## 注意事项
1. 文件格式要求：
   - 必须包含完整的晶胞参数
   - 原子顺序应与`atom_name`声明一致

2. 特殊假设：
   - 第一个原子类型默认为基底元素
   - z方向为表面法线方向

3. 性能说明：
   - 每100帧输出一次进度提示
   - 大数据集建议分批次处理

## 自定义调整
- 键长阈值：修改`bonds_func`中的1.2 Å参数
- 输出格式：调整xlsxwriter模板
- 基底识别：修改`oxygen_dist`中的z容差（默认1Å）

## 版本历史
v1.0 - 初始版本，实现核心分析功能
``` 
